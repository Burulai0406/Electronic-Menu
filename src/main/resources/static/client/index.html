<!DOCTYPE html>
<html lang="kg">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Chai Caffe</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Inter:wght@400;600&display=swap" rel="stylesheet" />
    <style>
        :root{
          --bg: #FEFFE7;
          --text: #1F3B2F;
          --accent: #FED2A0;
        }
        body{font-family:'Inter',sans-serif;background:var(--bg);color:var(--text); justify-content:center; -webkit-font-smoothing:antialiased}
        h1,h2,h3{font-family:'Playfair Display',serif}
        .btn-primary{background:var(--accent);color:var(--text);transition:transform .18s ease,box-shadow .18s ease}
        .btn-primary:hover{transform:scale(1.03);box-shadow:0 8px 20px rgba(0,0,0,.12)}
        /* simple animations (reliable) */
        .fade-slide-enter{opacity:0;transform:translateY(18px)}
        .fade-slide-enter.fade-slide-enter-active{opacity:1;transform:none;transition:opacity .36s ease,transform .36s ease}
        .fade-slide-leave{opacity:1;transform:none}
        .fade-slide-leave.fade-slide-leave-active{opacity:0;transform:translateY(-10px);transition:opacity .28s ease,transform .28s ease}
        /* card hover */
        .menu-card{transition:transform .22s ease,box-shadow .22s ease}
        .menu-card:hover{transform:translateY(-6px);box-shadow:0 12px 30px rgba(31,59,47,.08)}
        /* responsive adjustments */
        @media (max-width:640px){
          .h-96{height:360px}
        }
    </style>
</head>
<body class="min-h-screen">

<header class="sticky top-0 z-30 bg-white/70 backdrop-blur-md shadow-sm">
    <div class="max-w-6xl mx-auto flex items-center justify-between p-4">
        <h1 class="text-2xl md:text-3xl font-bold flex items-center gap-3">
            <span class="text-2xl">üçµ</span>
            <span id="brand-title">Chai Caffe</span>
        </h1>

        <nav class="flex items-center gap-3">
            <button data-section="about" class="px-3 py-1 rounded-md hover:bg-green-50 transition" data-i18n="about">–ë–∏–∑ –∂”©–Ω“Ø–Ω–¥”©</button>
            <button data-section="menu" class="px-3 py-1 rounded-md hover:bg-green-50 transition" data-i18n="menu">–ú–µ–Ω—é</button>
            <button data-section="contact" class="px-3 py-1 rounded-md hover:bg-green-50 transition" data-i18n="contact">–ë–∞–π–ª–∞–Ω—ã—à</button>

            <select id="langSelect" class="ml-3 px-2 py-1 rounded-md border">
                <option value="kg">KG</option>
                <option value="en">EN</option>
            </select>
        </nav>
    </div>
</header>
<!-- –ê–Ω–∏–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–∞—Ä—É—Å–µ–ª—å —Å –∞–∫—Ü–∏—è–º–∏ -->
<div class="relative overflow-hidden bg-gradient-to-r from-amber-50 to-orange-50">
    <div id="promoCarousel" class="flex transition-transform duration-700 ease-in-out" style="transform: translateX(0)">
        <!-- –°–ª–∞–π–¥ 1 -->
        <div class="min-w-full relative">
            <img src="https://images.unsplash.com/photo-1550258983-7b2a4f9e3dd5?w=1400&q=80"
                 alt="–ê–∫—Ü–∏—è: -20% –Ω–∞ –≤–µ—Å—å —á–∞–π!"
                 class="w-full h-96 object-cover brightness-75">
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center text-white px-6" data-aos="zoom-in" data-aos-delay="200">
                    <h2 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-2xl">‚Äì20% –Ω–∞ –≤–µ—Å—å —á–∞–π!</h2>
                    <p class="text-xl md:text-2xl drop-shadow-lg">–¢–æ–ª—å–∫–æ –¥–æ 10 –¥–µ–∫–∞–±—Ä—è</p>
                </div>
            </div>
        </div>

        <!-- –°–ª–∞–π–¥ 2 -->
        <div class="min-w-full relative">
            <img src="https://images.unsplash.com/photo-1512568400610-62da28bc8a13?w=1400&q=80"
                 alt="2 –¥–µ—Å–µ—Ä—Ç–∞ –ø–æ —Ü–µ–Ω–µ 1"
                 class="w-full h-96 object-cover brightness-75">
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center text-white px-6" data-aos="zoom-in" data-aos-delay="200">
                    <h2 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-2xl">2 –¥–µ—Å–µ—Ä—Ç–∞ = 1 —Ü–µ–Ω–∞!</h2>
                    <p class="text-xl md:text-2xl drop-shadow-lg">–ü—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 1000 —Å–æ–º</p>
                </div>
            </div>
        </div>

        <!-- –°–ª–∞–π–¥ 3 -->
        <div class="min-w-full relative">
            <img src="https://images.unsplash.com/photo-1495474472287-4d71bc168240?w=1400&q=80"
                 alt="–ù–æ–≤–æ–µ –∑–∏–º–Ω–µ–µ –º–µ–Ω—é"
                 class="w-full h-96 object-cover brightness-75">
            <div class="absolute inset-0 flex items-center justify-center">
                <div class="text-center text-white px-6" data-aos="zoom-in" data-aos-delay="200">
                    <h2 class="text-4xl md:text-6xl font-bold mb-4 drop-shadow-2xl">–ó–∏–º–Ω–µ–µ –º–µ–Ω—é —É–∂–µ –∑–¥–µ—Å—å!</h2>
                    <p class="text-xl md:text-2xl drop-shadow-lg">–ì–æ—Ä—è—á–∏–π —à–æ–∫–æ–ª–∞–¥ –∏ –∏–º–±–∏—Ä–Ω—ã–π —á–∞–π ‚ô°</p>
                </div>
            </div>
        </div>
    </div>

    <!-- –ö–Ω–æ–ø–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è -->
    <button id="prevSlide" class="absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-3 shadow-lg transition z-10">
        ‚Üê
    </button>
    <button id="nextSlide" class="absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white rounded-full p-3 shadow-lg transition z-10">
        ‚Üí
    </button>

    <!-- –¢–æ—á–∫–∏ -->
    <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
        <span class="dot w-3 h-3 bg-white/60 rounded-full cursor-pointer transition"></span>
        <span class="dot w-3 h-3 bg-white/60 rounded-full cursor-pointer transition"></span>
        <span class="dot w-3 h-3 bg-white/60 rounded-full cursor-pointer transition"></span>
    </div>
</div>

<main class="max-w-6xl mx-auto px-4 sm:px-6 md:px-8">

    <section id="about" class="mb-12" data-aos="fade-up">
        <div class="rounded-2xl overflow-hidden shadow-2xl ">
            <img src="https://i.pinimg.com/736x/28/99/a0/2899a036a783be92b19a8cdbfa6e0636.jpg"
                 alt="Chai Caffe Interior"
                 class="w-full h-96 md:h-[500px] lg:h-[600px] object-cover object-center">
            <div class="p-8 bg-white">
                <h2 class="text-4xl md:text-5xl font-bold mb-4" data-i18n="about_title">Chai Caffe</h2>
                <p class="text-gray-700 text-base md:text-lg leading-relaxed" data-i18n="about_text"></p>
            </div>
        </div>
    </section>


    <section id="menu" class="mb-12">
        <div id="categories" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6 "></div>

        <div id="itemsBlock" class="mt-6 hidden">
            <button id="backToCats" class="mb-4 px-4 py-2 btn-primary rounded-full">‚Üê Back to categories</button>
            <div id="itemsList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
    </section>

    <section id="contact" class="mb-12 hidden">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <div class="bg-white rounded-2xl p-6 shadow-lg">
                <h2 class="text-3xl font-bold mb-4" data-i18n="contact_title">–ë–∞–π–ª–∞–Ω—ã—à</h2>
                <p>
                    Instagram: <a href="https://instagram.com/chai.caffe" target="_blank" class="text-amber-600">@chai.caffe</a><br>
                    WhatsApp: <a href="https://wa.me/996" target="_blank" class="text-amber-600">+996 709 853 999</a><br>
                    Address: –≥. –ë–∏—à–∫–µ–∫, —É–ª. –¢–æ–∫—Ç–æ–≥—É–ª–∞ 75
                </p>
            </div>

            <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                <iframe class="w-full h-96"
                        src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d5848.123456789!2d74.590123!3d42.874621!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x0%3A0x0!2zNDLCsDUyJzI5LjYiTiA3NMKwMzUnMjQuNCJF!5e0!3m2!1sen!2skg!4v..."
                        loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
        </div>
    </section>
</main>

<footer class="p-6 text-center text-gray-600">
    ¬© 2025 Chai Caffe ‚Ä¢ @chai.caffe ‚Ä¢ –ö“Ø–Ω —Å–∞–π—ã–Ω 08:00 ‚Äì 23:00 –°–µ–Ω–∏ –∫“Ø—Ç”©–±“Ø–∑ ‚ô°
    Daily 08:00 ‚Äì 23:00 We‚Äôre waiting for you ‚ô°
</footer>

<script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
<script>
    AOS.init({ once: true, duration: 900 });

    const API_BASE = '/api/client';
    // Only KG and EN
    let lang = localStorage.getItem('lang') || 'kg';
    let categoriesData = [];
    let currentItems = [];
    let loadingCategory = false; // prevent double clicks while loading

    // i18n (KG + EN only)
    const i18n = {
      kg: {
        about: '–ë–∏–∑ –∂”©–Ω“Ø–Ω–¥”©',
        about_title: 'Chai Caffe',
        about_text: 'Chai caffe ‚Äî –±—É–ª —à–∞–∞—Ä–¥—ã–Ω –±–æ—Ä–±–æ—Ä—É–Ω–¥–∞ –∂–∞–π–≥–∞—à–∫–∞–Ω —É—é—Ç—Ç—É—É –∂–µ—Ä, –∞–Ω–¥–∞ –∞—Ä–æ–º–∞—Ç—Ç—É—É –∫–æ—Ñ–µ –∂–∞–Ω–∞ —Å–∞–ª—Ç—Ç—É—É —á–∞–π –∫–µ–∑–∏–≥–µ—Ç. –ë–∏–∑ –±–∞—Ä–¥—ã–∫ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—Ç–µ—Ä–¥–∏ —Ç–∞–∑–∞ –∂–∞–Ω–∞ —Ç–∞–±–∏–≥—ã–π –∫–æ–ª–¥–æ–Ω—É–ø –¥–∞—è—Ä–¥–∞–π–±—ã–∑. –ë–∏–∑–¥–∏–Ω –∞–≤—Ç–æ—Ä–¥—É–∫ —á–∞–π –º–µ–Ω–µ–Ω —ç—Å –∞–ª—ã“£—ã–∑, ”©–∑ –∫–æ–ª—É“£—É–∑ –º–µ–Ω–µ–Ω –∂–∞—Å–∞–ª–≥–∞–Ω –¥–µ—Å–µ—Ä—Ç—Ç–µ—Ä–¥–∏ —Ç–∞—Ç—ã–ø –∫”©—Ä“Ø“£“Ø–∑ –∂–∞–Ω–∞ –∂—ã–ª—É—É –∞—Ç–º–æ—Å—Ñ–µ—Ä–∞–¥–∞–Ω —ã—Ä–∞—Ö–∞—Ç –∞–ª—ã“£—ã–∑. –ë–∏–∑ —Å–∏–∑–¥–∏ –∫—É–±–∞–Ω—ã—á –º–µ–Ω–µ–Ω –∫“Ø—Ç”©–±“Ø–∑!',
        menu: '–ú–µ–Ω—é',
        contact: '–ë–∞–π–ª–∞–Ω—ã—à',
        contact_title: '–ë–∞–π–ª–∞–Ω—ã—à'
      },
      en: {
        about: 'About us',
        about_title: 'Chai Caffe',
        about_text: 'Chai caffe is a cozy place in the heart of the city where aromatic coffee meets traditional tea. We prepare with love using only fresh, natural ingredients. Relax with our signature tea, try homemade desserts, and enjoy the warm atmosphere. We are happy to welcome you!',
        menu: 'Menu',
        contact: 'Contact',
        contact_title: 'Contact'
      }
    };

    // helpers for animation toggles (reliable)
    function animateIn(el){
      el.classList.remove('fade-slide-leave','fade-slide-leave-active');
      el.classList.add('fade-slide-enter');
      // force reflow then add active
      requestAnimationFrame(()=>{
        el.classList.add('fade-slide-enter-active');
        // cleanup after transition
        setTimeout(()=>el.classList.remove('fade-slide-enter','fade-slide-enter-active'),400);
      });
    }
    function animateOut(el, cb){
      el.classList.remove('fade-slide-enter','fade-slide-enter-active');
      el.classList.add('fade-slide-leave');
      requestAnimationFrame(()=>{
        el.classList.add('fade-slide-leave-active');
        setTimeout(()=>{
          el.classList.remove('fade-slide-leave','fade-slide-leave-active');
          cb && cb();
        },320);
      });
    }

    // DOM refs
    const elements = document.querySelectorAll('[data-i18n]');
    const langSelect = document.getElementById('langSelect');
    const categoriesContainer = document.getElementById('categories');
    const itemsBlock = document.getElementById('itemsBlock');
    const itemsList = document.getElementById('itemsList');
    const backBtn = document.getElementById('backToCats');

    // Apply translations
    function applyI18n(){
      elements.forEach(el=>{
        const key = el.dataset.i18n;
        if(!key) return;
        el.innerHTML = (i18n[lang] && i18n[lang][key]) ? i18n[lang][key] : (i18n['en'][key] || key);
      });
    }

    // Language handling
    langSelect.value = lang;
    langSelect.addEventListener('change', (e)=>{
      lang = e.target.value;
      localStorage.setItem('lang', lang);
      applyI18n();
      // re-render visible content in new language
      if(!itemsBlock.classList.contains('hidden')) renderItems(); else renderCategories();
    });

    applyI18n();

    // Section nav (header buttons)
    document.querySelectorAll('button[data-section]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const id = btn.dataset.section;
        ['about','menu','itemsBlock','contact'].forEach(s=>{
          const el = document.getElementById(s);
          if(!el) return;
          if(s === id) {
            el.classList.remove('hidden');
            animateIn(el);
          } else {
            el.classList.add('hidden');
          }
        });
        // if returning to menu ensure categories shown
        if(id === 'menu'){
          itemsBlock.classList.add('hidden');
          categoriesContainer.classList.remove('hidden');
        }
      });
    });

    // Fetch categories from API
    async function fetchCategories(){
      try{
        const res = await fetch(`${API_BASE}/categories`);
        const data = await res.json();
        categoriesData = Array.isArray(data) ? data : [];
        renderCategories();
      }catch(err){
        console.error('fetchCategories error', err);
        categoriesData = [];
        categoriesContainer.innerHTML = `<div class="text-red-600 p-4">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π</div>`;
      }
    }

    // Render categories (no search)
    function renderCategories(){
      categoriesContainer.innerHTML = '';
      itemsBlock.classList.add('hidden');
      categoriesContainer.classList.remove('hidden');
      // animate container
      animateIn(categoriesContainer);

      if(!categoriesData.length){
        categoriesContainer.innerHTML = `<div class="p-6 bg-white rounded-2xl shadow text-gray-600">–ö–∞—Ç–µ–≥–æ—Ä–∏–π –Ω–µ—Ç</div>`;
        return;
      }

      categoriesData.forEach(cat=>{
        const name = (lang === 'kg' ? (cat.name_kg || cat.name_en) : (cat.name_en || cat.name_kg));
        const img = cat.image_url || '/assets/placeholder.png';
        const card = document.createElement('div');
        card.className = 'bg-white rounded-2xl p-4 shadow menu-card cursor-pointer flex flex-col items-center';
        card.innerHTML = `
          <img src="${img}" alt="${escapeHtml(name)}" class="w-full h-40 object-cover rounded-lg mb-3">
          <h3 class="text-lg font-semibold text-center">${escapeHtml(name)}</h3>
        `;
        // click handler: show items immediately and load
        card.addEventListener('click', ()=> onCategoryClick(cat.id, card));
        categoriesContainer.appendChild(card);
      });
    }

    // safe text escape
    function escapeHtml(s){ return String(s||'').replace(/[&<>"']/g, c=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[c])); }

    // click category
    async function onCategoryClick(categoryId, clickedCard){
      if(loadingCategory) return; // prevent double
      loadingCategory = true;

      // immediately hide categories and show itemsBlock (instant UX)
      // but animate categories out first for smoothness OR hide instantly to ensure immediate show
      // We'll hide instantly for reliability:
      categoriesContainer.classList.add('hidden');
      itemsBlock.classList.remove('hidden');
      // prepare empty itemsList and animate in
      itemsList.innerHTML = `<div class="col-span-full p-6 bg-white rounded-2xl shadow text-gray-500">Loading...</div>`;
      itemsBlock.style.opacity = 0;
      requestAnimationFrame(()=> {
        itemsBlock.style.transition = 'opacity .32s ease, transform .32s ease';
        itemsBlock.style.transform = 'translateY(8px)';
        itemsBlock.style.opacity = 1;
        setTimeout(()=> itemsBlock.style.transform = 'none', 20);
      });

      try{
        const res = await fetch(`${API_BASE}/items/${categoryId}`);
        const data = await res.json();
        currentItems = Array.isArray(data) ? data : [];
        renderItems(); // render with currentItems
      }catch(err){
        console.error('loadItems error', err);
        itemsList.innerHTML = `<div class="col-span-full p-6 bg-white rounded-2xl shadow text-red-600">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –±–ª—é–¥</div>`;
      } finally {
        loadingCategory = false;
      }
    }

    // Render items (no search)
    function renderItems(){
      itemsList.innerHTML = '';
      if(!currentItems.length){
        itemsList.innerHTML = `<div class="col-span-full p-6 bg-white rounded-2xl shadow text-gray-600">–ë–ª—é–¥ –Ω–µ—Ç</div>`;
        return;
      }
      // create cards
      currentItems.forEach(item=>{
        const name = (lang === 'kg' ? (item.name_kg || item.name_en) : (item.name_en || item.name_kg));
        const desc = (lang === 'kg' ? (item.description_kg || item.description_en || '') : (item.description_en || item.description_kg || ''));
        const img = item.image_url || '/assets/placeholder.png';
        const priceLabel = (lang === 'kg' ? '–ë–∞–∞—Å—ã' : 'Price');
        const price = item.price ?? '---';

        const card = document.createElement('div');
        card.className = 'bg-white rounded-2xl p-4 shadow menu-card';
        card.innerHTML = `
          <div class="w-full h-44 md:h-36 overflow-hidden rounded-lg mb-3">
            <img src="${img}" alt="${escapeHtml(name)}" class="w-full h-full object-cover">
          </div>
          <h4 class="font-semibold text-lg mb-1">${escapeHtml(name)}</h4>
          <p class="text-sm text-gray-600 mb-3">${escapeHtml(desc)}</p>
          <div class="mt-auto font-medium">${priceLabel}: ${escapeHtml(price)} —Å–æ–º</div>
        `;
        // staggered animation for cards
        card.style.opacity = 0;
        card.style.transform = 'translateY(12px)';
        itemsList.appendChild(card);
        // stagger
        const idx = itemsList.children.length;
        setTimeout(()=> {
          card.style.transition = 'opacity .36s ease, transform .36s ease';
          card.style.opacity = 1;
          card.style.transform = 'none';
        }, 40 * idx);
      });
      // scroll into view
      itemsBlock.scrollIntoView({behavior:'smooth', block:'start'});
    }

    // Back button
    backBtn.addEventListener('click', ()=>{
      // animate hide itemsBlock quickly
      itemsBlock.style.transition = 'opacity .28s ease, transform .28s ease';
      itemsBlock.style.opacity = 0;
      itemsBlock.style.transform = 'translateY(10px)';
      setTimeout(()=>{
        itemsBlock.classList.add('hidden');
        // show categories again
        renderCategories();
        // reset current items
        currentItems = [];
      }, 300);
    });
    // ===== –ö–ê–†–£–°–ï–õ–¨ –° –ê–ö–¶–ò–Ø–ú–ò =====
const carousel = document.getElementById('promoCarousel');
const slides = carousel.children;
const dots = document.querySelectorAll('.dot');
let currentSlide = 0;
const totalSlides = slides.length;

function updateCarousel() {
  carousel.style.transform = `translateX(-${currentSlide * 100}%)`;
  dots.forEach((dot, i) => {
    dot.style.backgroundColor = i === currentSlide ? 'white' : 'rgba(255,255,255,0.6)';
    dot.style.transform = i === currentSlide ? 'scale(1.3)' : 'scale(1)';
  });
}

document.getElementById('nextSlide').addEventListener('click', () => {
  currentSlide = (currentSlide + 1) % totalSlides;
  updateCarousel();
});

document.getElementById('prevSlide').addEventListener('click', () => {
  currentSlide = (currentSlide - 1 + totalSlides) % totalSlides;
  updateCarousel();
});

dots.forEach((dot, i) => {
  dot.addEventListener('click', () => {
    currentSlide = i;
    updateCarousel();
  });
});

// –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞ –∫–∞–∂–¥—ã–µ 6 —Å–µ–∫—É–Ω–¥
setInterval(() => {
  currentSlide = (currentSlide + 1) % totalSlides;
  updateCarousel();
}, 6000);

updateCarousel(); // –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è

    // Initialize
    fetchCategories();

</script>
</body>
</html>
